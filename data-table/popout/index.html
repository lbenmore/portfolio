<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no, shrink-to-fit=no'>
    <title>Grid Popout</title>
    <style>
    </style>
  </head>
  <body>
    <div class='container'>
      <button class='btn btn--load'>Load Grid</button>
      <pre><code class='output'></code></pre>
    </div>

    <script type='text/javascript' src='../scripts/bnmr.js'></script>
    <script>
      loadPopout = (width, height) => {
        let
        offsetTop = window.innerHeight - height,
        offsetLeft = window.innerWidth - width,
        popout = window.open('../index.html', 'gridWindow', `top=${offsetTop}, left=${offsetLeft}, width=${width}, height=${height}, menubar=0, toolbar=0, location=0, personalbar=0, status=0`);

        popout.addEventListener('message', (e) => {
          let
          data = JSON.parse(e.data).data,
          formattedData = '',
          tempSet,
          allEmpties;

          for (let row of data) {
            tempSet = '';
            allEmpties = true;

            for (let prop in row) {
              tempSet += `${prop}: ${row[prop]} \n`;
              if (row[prop] != '') allEmpties = false;
            }
            if (!allEmpties) formattedData += `${tempSet} \n`;
          }

          $$('.output').innerHTML = formattedData;
        });
      };

      $$('.btn--load').on('tap', loadPopout.bind(null, 800, 600));
    </script>
  </body>
</html>
